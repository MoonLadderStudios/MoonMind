version: "v0"
metadata:
  name: "repo-docs"
  description: "Index README + docs from MoonMind"
  owner: "search-platform@moonladdr"
  tags: ["docs", "example", "minimal"]

embeddings:
  provider: "openai"
  model: "text-embedding-3-large"

vectorStore:
  type: "pgvector"
  indexName: "mm_repo_docs"
  connection:
    dsn: "${PG_DSN}"

dataSources:
  - id: "mm-repo"
    type: "GithubRepositoryReader"
    params:
      owner: "MoonLadderStudios"
      repo: "MoonMind"
      branch: "main"
      include: ["README.md", "docs/**/*.md"]
      exclude: ["**/node_modules/**", "**/*.png", "**/*.svg", "**/*.jpg"]
      maxFiles: 500
    auth:
      githubToken: "${GITHUB_TOKEN}"

transforms:
  splitter:
    type: "TokenTextSplitter"
    chunkSize: 1000
    chunkOverlap: 100
  htmlToText: true

indices:
  - id: "mm_repo_vector"
    type: "VectorStoreIndex"
    sources: ["mm-repo"]

retrievers:
  - id: "mm_repo_vector_r"
    type: "Vector"
    indices: ["mm_repo_vector"]
    params: { topK: 8 }

postprocessors:
  - type: "SimilarityCutoff"
    threshold: 0.76

run:
  concurrency: 6
  errorPolicy: "continue"

observability:
  tracing: "opentelemetry"
  logs: "stdout"

security:
  piiRedaction: false
  allowlistMetadata: ["path", "repo", "branch", "owner", "docType"]
