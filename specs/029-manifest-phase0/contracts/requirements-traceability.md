# Requirements Traceability Matrix: Manifest Queue Phase 0

**Feature**: `029-manifest-phase0`  
**Source**: `docs/ManifestTaskSystem.md`

| DOC-REQ ID | Mapped FR(s) | Planned Implementation Surface | Validation Strategy |
|------------|--------------|--------------------------------|--------------------|
| `DOC-REQ-001` (register manifest job type & restrict workers) | `FR-001`, `FR-009`, `FR-010` | `moonmind/workflows/agent_queue/job_types.py` (allowlist), `service.py` (type enforcement), `repositories.py::_is_job_claim_eligible` (capability gating), `api_service/api/routers/agent_queue.py` (type filter + sanitized responses) | Unit tests under `tests/unit/workflows/agent_queue` verify manifest payloads require capabilities and claim filtering rejects workers missing `manifest`; router tests assert `/api/queue/jobs?type=manifest` exposes only manifest metadata |
| `DOC-REQ-002` (manifest contract module) | `FR-002`, `FR-003`, `FR-006`, `FR-010` | `moonmind/workflows/agent_queue/manifest_contract.py` (normalization, option allowlist, error types), `api_service/services/manifests_service.py` (registry reuse), `api_service/api/routers/manifests.py` (surfacing validation errors) | Contract tests covering name mismatch, invalid YAML, unsupported adapters/options executed via `./tools/test_unit.sh` |
| `DOC-REQ-003` (derive requiredCapabilities server-side) | `FR-004`, `FR-005`, `FR-010` | `derive_required_capabilities()` implementation, queue job creation path in `AgentQueueService.create_job`, registry-backed run submission in `ManifestsService.submit_manifest_run` | Unit tests ensure client-supplied capabilities are ignored and that the derived list includes manifest/embeddings/vector store/source adapters; queue job fixture tests assert persisted payload carries normalized set |
| `DOC-REQ-004` (persist manifestHash/version + audit metadata) | `FR-005`, `FR-009`, `FR-010` | Manifest payload normalization (hash + version), sanitized payload helper used by `JobModel` serializer, `ManifestRecord` persistence of `content_hash` / `version` | Tests verify queue payload stores `manifestHash`, `manifestVersion`, and responses include these fields but omit inline YAML; registry upsert tests assert hashes stay stable across PUTs |
| `DOC-REQ-005` (manifest registry CRUD + run submission) | `FR-007`, `FR-008`, `FR-010` | `api_service/api/routers/manifests.py`, `api_service/services/manifests_service.py`, queue service integration with `MANIFEST_JOB_TYPE`, OpenAPI contract `contracts/manifest-phase0.openapi.yaml` | Router/service unit tests assert GET/PUT/POST behaviors (404/422 handling, queue invocation, metadata serialization); Quickstart and automated tests executed via `./tools/test_unit.sh` validate end-to-end flow |
