<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>MoonMind Tasks</title>
    <script>
      (() => {
        const key = "moonmind.theme";
        const root = document.documentElement;
        let stored = null;

        try {
          const raw = window.localStorage ? window.localStorage.getItem(key) : null;
          stored = raw === "dark" || raw === "light" ? raw : null;
          if (raw && !stored && window.localStorage) {
            window.localStorage.removeItem(key);
          }
        } catch (_error) {
          stored = null;
        }

        const prefersDark =
          window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
        const mode = stored || (prefersDark ? "dark" : "light");
        root.classList.toggle("dark", mode === "dark");
        root.dataset.theme = mode;
      })();
    </script>
    <link rel="stylesheet" href="/static/task_dashboard/dashboard.css" />
  </head>
  <body>
    <main class="dashboard-root">
      <header class="masthead">
        <div class="masthead-copy">
          <p class="eyebrow">MoonMind Operations</p>
          <h1>Tasks Dashboard</h1>
        </div>
      </header>

      <section class="worker-pause" data-worker-pause hidden aria-live="polite">
        <div class="worker-pause-status">
          <p class="worker-pause-label" data-worker-pause-status>Workers: Running</p>
          <p class="worker-pause-reason" data-worker-pause-reason></p>
        </div>
        <div class="worker-pause-metrics">
          <div class="metric">
            <span class="metric-label">Queued</span>
            <span class="metric-value" data-worker-pause-metric="queued">0</span>
          </div>
          <div class="metric">
            <span class="metric-label">Running</span>
            <span class="metric-value" data-worker-pause-metric="running">0</span>
          </div>
          <div class="metric">
            <span class="metric-label">Stale</span>
            <span class="metric-value" data-worker-pause-metric="staleRunning">0</span>
          </div>
          <div class="metric">
            <span class="metric-label">Drained</span>
            <span class="metric-value" data-worker-pause-drained>No</span>
          </div>
        </div>
        <div class="worker-pause-controls">
          <form data-worker-pause-form="pause">
            <fieldset>
              <legend>Pause Workers</legend>
              <label>
                Mode
                <select name="mode" required>
                  <option value="drain" selected>Drain (default)</option>
                  <option value="quiesce">Quiesce</option>
                </select>
              </label>
              <label>
                Reason
                <input type="text" name="reason" maxlength="160" required />
              </label>
              <button type="submit">Pause Workers</button>
            </fieldset>
          </form>
          <form data-worker-pause-form="resume">
            <fieldset>
              <legend>Resume Workers</legend>
              <label>
                Reason
                <input type="text" name="reason" maxlength="160" required />
              </label>
              <button type="submit">Resume Workers</button>
            </fieldset>
          </form>
        </div>
        <p class="worker-pause-error" data-worker-pause-error hidden></p>
      </section>

      <nav class="route-nav" aria-label="Task dashboard navigation">
        <a href="/tasks" data-nav>Active</a>
        <a href="/tasks/queue" data-nav>Queue</a>
        <a href="/tasks/queue/new" data-nav>Queue Submit</a>
        <a href="/tasks/orchestrator" data-nav>Orchestrator</a>
        <a href="/tasks/orchestrator/new" data-nav>Orchestrator Submit</a>
        <a href="/tasks/manifests" data-nav>Manifests</a>
        <a href="/tasks/manifests/new" data-nav>Manifest Submit</a>
        <a href="/tasks/proposals" data-nav>Proposals</a>
      </nav>

      <section class="panel" id="dashboard-content" aria-live="polite">
        <p class="loading">Loading dashboard...</p>
      </section>
    </main>

    <script id="task-dashboard-config" type="application/json">
      {{ dashboard_config | tojson }}
    </script>
    <script defer src="/static/task_dashboard/dashboard.js"></script>
  </body>
</html>
